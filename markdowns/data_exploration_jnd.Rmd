---
title: "Explore Data"
author: "Jody Daniel"
date: "`r Sys.Date()`"
output: 
 markdowntemplates::bulma:
    highlight: tango
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(readxl)
library(stringi)
library(stringr)
library(vegan)
library(writexl)
library(ggthemes)
library(ggrepel)
library(viridis)
source(paste0(here::here(), "/scripts/functions.R"))
```

# Background

Need to do work on congruence between birds and plants - not able to do fish as we did not collected at the same plots. The data for birds are `r paste0(here::here(), "data/bird_matrix.csv")`. Need to prepare the plant data, however.

# Data Preparation
For plants, we have the total number trees, by DBH, in each plot - associated with each DBH catgeory, we have the canopy width and tree height. From this ifnormation, we can measure relative density of each species in each plot. We can also get a mean/median and max height for each species present. Thus, I will create 3 sepertae files:

* Basal Area - the total area of each species in a plot. Using a representative tree, we find the basal area (p*r^2, where r = DBH/2) and multiple this value by total number of trees. Because the DBH categories were within categories, we will use the median value in each interval. We repeat this for each DBH category and sum by species.
* Mean Canopy Width - we find the mean of canopy width of trees for by species. 
* Mean Tree Height - we find the weighted mean of tree height of of trees for by species. 

Following, because we merged some plots for our bird analyses because of their proximity to other plots, we fill average these values across plot groups. This is what we will use for the congruence analsyes.

```{r message=FALSE, error=FALSE, warning=FALSE}
VegDataRaw <- read_excel(paste0(here::here(),
                                "/data/Bird and Veg Data - complete and validated.xlsx"), sheet = "Plants") %>%
  rename(SiteName = Site)%>%
  mutate(SiteCode = case_when(SiteName == "Westerhall" ~ "WH",
                            SiteName == "Conference" ~ "CN",
                            SiteName == "Levera" ~ "LV",
                            SiteName == "Mt. Hartman" ~ "MH"),
         SiteID = paste0(SiteCode, "-", "T", Transect, "-",  "P", Plot )) %>%
  relocate(SiteCode, .after = SiteName)%>%
  relocate(SiteID, .after = SiteName)%>%
  filter(!is.na(SiteName))%>%
  left_join(read_excel(paste0(here::here(),
                                "/data/Bird and Veg Data - complete and validated.xlsx"), 
                       sheet = "Site Info") %>%
              rename(`SiteID`= "Site ID")%>%
              rename(SiteName = "Area"))%>%
  relocate(Independent, .after = "SiteName") %>%
  relocate(SiteID, .after = "SiteName") %>%
  relocate(Longitude, .before = "Date")%>%
  relocate(Latitude, .before = "Date")

BirdData <- VegDataRaw %>% select(SiteName, SiteID, Independent)%>%
  right_join(read_excel(paste0(here::here(),
                                "/data/Bird and Veg Data - complete and validated.xlsx"), sheet = "Birds")%>%
  rename(SiteName = "Site")%>%
  mutate(SiteCode = case_when(SiteName == "Westerhall" ~ "WH",
                            SiteName == "Conference" ~ "CN",
                            SiteName == "Levera" ~ "LV",
                            SiteName == "Mt. Hartman" ~ "MH"),
         SiteID = paste0(SiteCode, "-", "T", Transect, "-",  "P", Plot ))) %>%
  group_by(SiteName, Independent, Species) %>%
  summarise(Abundance = (mean(Abundance, na.rm = TRUE)) %>% round())%>%
  pivot_wider(names_from  = "Species",
              values_from = "Abundance",
              values_fill = 0)%>% filter(!is.na(SiteName))

BirdDataSum <-  VegDataRaw %>% select(SiteName, SiteID, Independent)%>%
  right_join(read_excel(paste0(here::here(),
                                "/data/Bird and Veg Data - complete and validated.xlsx"), sheet = "Birds")%>%
  rename(SiteName = "Site")%>%
  mutate(SiteCode = case_when(SiteName == "Westerhall" ~ "WH",
                            SiteName == "Conference" ~ "CN",
                            SiteName == "Levera" ~ "LV",
                            SiteName == "Mt. Hartman" ~ "MH"),
         SiteID = paste0(SiteCode, "-", "T", Transect, "-",  "P", Plot ))) %>%
  group_by(SiteName, Independent, Species) %>%
  summarise(Abundance = (sum(Abundance, na.rm = TRUE)) %>% round())%>%
  pivot_wider(names_from  = "Species",
              values_from = "Abundance",
              values_fill = 0)%>% filter(!is.na(SiteName))



BirdDatDateSum <-  VegDataRaw %>% select(SiteName, SiteID, Independent)%>%
  right_join(read_excel(paste0(here::here(),
                                "/data/Bird and Veg Data - complete and validated.xlsx"), sheet = "Birds")%>%
  rename(SiteName = "Site")%>%
  mutate(SiteCode = case_when(SiteName == "Westerhall" ~ "WH",
                            SiteName == "Conference" ~ "CN",
                            SiteName == "Levera" ~ "LV",
                            SiteName == "Mt. Hartman" ~ "MH"),
         SiteID = paste0(SiteCode, "-", "T", Transect, "-",  "P", Plot ))) %>%
  group_by(SiteName, SiteID, Independent, Date, Species) %>%
  summarise(Abundance = (sum(Abundance, na.rm = TRUE)) %>% round())%>%
  pivot_wider(names_from  = "Species",
              values_from = "Abundance",
              values_fill = 0)%>% filter(!is.na(SiteName))
  
```

```{r message=FALSE, error=FALSE, warning=FALSE}
VegDatLong <- VegDataRaw %>%
  select(contains(c("Site", "Independent", "_T_")))%>%
  pivot_longer(cols = contains("_T_"),
               names_to = c("Species", "Circumference"),
               names_pattern = "(.*)_T_(.*)",
               values_to = "Total") %>%
  left_join(VegDataRaw %>%
  select(contains(c("Site", "Independent", "_TH_")))%>%
  pivot_longer(cols = contains("_TH_"),
               names_to = c("Species", "Circumference"),
               names_pattern = "(.*)_TH_(.*)",
               values_to = "Tree Height")) %>%
  left_join(VegDataRaw %>%
  select(contains(c("Site", "Independent", "_CW_")))%>%
  pivot_longer(cols = contains("_CW_"),
               names_to = c("Species", "Circumference"),
               names_pattern = "(.*)_CW_(.*)",
               values_to = "Canopy Width")) %>%
  mutate(DBHRange = case_when(Circumference == "0-3.18" ~ "0-10",
                         Circumference == "3.19-7.96" ~ "10-25",
                         Circumference == "7.98-31.82" ~ "25-100",
                         Circumference == "31.83-63.65" ~ "100-200",
                         Circumference == ">63" ~ ">200"))%>%
  mutate(DBHMin = ifelse(stringr::str_detect(DBHRange, ">"), 200, 
                         (stringr::str_remove(DBHRange, "-.*"))) %>% as.numeric(),
         DBHMax = ifelse(stringr::str_detect(DBHRange, ">"), NA_real_, 
                         (stringr::str_remove(DBHRange, ".*-"))) %>% as.numeric()) %>%
  rowwise()%>%
  mutate(DBH = ifelse(DBHMin == 200, 200, median(c(DBHMax, DBHMin))))%>%
  ungroup()%>%
  mutate(`Basal Area (m^2)` = (3.142 * (DBH/2 * 0.001)) * Total)
  
```

# Site Summary


```{r}
VegDatLong %>%
  group_by(SiteName)%>%
  summarise(BasalAreaMean = mean(`Basal Area (m^2)`[`Basal Area (m^2)`!= 0]),
            BasalAreaSD = sd(`Basal Area (m^2)`[`Basal Area (m^2)`!= 0]),
            CanopyWidthMean = mean(`Canopy Width`[`Canopy Width`!= 0]),
            CanopyWidthSD = sd(`Canopy Width`[`Canopy Width`!= 0]),
            HeightMean = mean(`Tree Height`[`Tree Height`!= 0]),
            HeightSD = sd(`Tree Height`[`Tree Height`!= 0]))

```


```{r message=FALSE, error=FALSE, warning=FALSE}

VegMatrixSiteID <-
  VegDatLong %>% group_by(SiteName, SiteID, Species) %>%
  summarise(BasalArea = mean(`Basal Area (m^2)`[`Basal Area (m^2)`!= 0] , na.rm = TRUE)) %>%
  pivot_wider(names_from = "Species", values_from = "BasalArea") %>%
  rename(`RedBasalArea` = "Red")%>%
   rename(`BlackBasalArea` = "Black") %>%
   rename(`WhiteBasalArea` = "White")%>%
  left_join(VegDatLong %>% group_by(SiteName, SiteID, Species) %>%
  summarise(CanopyWidth = mean(`Canopy Width`[`Canopy Width`!= 0] , na.rm = TRUE)) %>%
  pivot_wider(names_from = "Species", values_from = "CanopyWidth") %>%
  rename(`RedCanopyWidth` = "Red")%>%
   rename(`BlackCanopyWidth` = "Black") %>%
   rename(`WhiteCanopyWidth` = "White"))%>%
  left_join(VegDatLong %>% group_by(SiteName, SiteID, Species) %>%
  summarise(TreeHeight = mean(`Tree Height`[`Tree Height`!= 0] , na.rm = TRUE)) %>%
  pivot_wider(names_from = "Species", values_from = "TreeHeight") %>%
  rename(`RedTreeHeight` = "Red")%>%
   rename(`BlackTreeHeight` = "Black") %>%
   rename(`WhiteTreeHeight` = "White"))%>%
  mutate(across(.cols = everything(), ~ ifelse(is.infinite(.x), 0, .x)))%>%
  mutate(across(.cols = everything(), ~ ifelse(is.na(.x), 0, .x)))
  

VegMatrixIndependent <-
  VegDatLong %>%  group_by(SiteName, Independent, Species) %>%
  summarise(BasalArea = mean(`Basal Area (m^2)`[`Basal Area (m^2)`!= 0] , na.rm = TRUE)) %>%
  pivot_wider(names_from = "Species", values_from = "BasalArea") %>%
  rename(`RedBasalArea` = "Red")%>%
   rename(`BlackBasalArea` = "Black") %>%
   rename(`WhiteBasalArea` = "White")%>%
  left_join(VegDatLong %>% group_by(SiteName, Independent, Species) %>%
  summarise(CanopyWidth = mean(`Canopy Width`[`Canopy Width`!= 0] , na.rm = TRUE)) %>%
  pivot_wider(names_from = "Species", values_from = "CanopyWidth") %>%
  rename(`RedCanopyWidth` = "Red")%>%
   rename(`BlackCanopyWidth` = "Black") %>%
   rename(`WhiteCanopyWidth` = "White"))%>%
  left_join(VegDatLong %>% group_by(SiteName, Independent, Species) %>%
  summarise(TreeHeight = mean(`Tree Height`[`Tree Height`!= 0] , na.rm = TRUE)) %>%
  pivot_wider(names_from = "Species", values_from = "TreeHeight") %>%
  rename(`RedTreeHeight` = "Red")%>%
   rename(`BlackTreeHeight` = "Black") %>%
   rename(`WhiteTreeHeight` = "White")) %>% filter(!is.na(Independent))%>%
  mutate(across(.cols = everything(), ~ ifelse(is.infinite(.x), 0, .x)))%>%
  mutate(across(.cols = everything(), ~ ifelse(is.na(.x), 0, .x)))

```




```{r message=FALSE, error=FALSE, warning=FALSE}



TreeHeightBird <- 
  CongruenceCrossTaxon(DataVeg = VegMatrixIndependent, BirdData, ColTraitVeg = "TreeHeight") %>% arrange(Test)


BasalAreaBird <- 
  CongruenceCrossTaxon(DataVeg = VegMatrixIndependent, BirdData, ColTraitVeg = "BasalArea") %>% arrange(Test)

CanopyWidthBird <- 
  CongruenceCrossTaxon(DataVeg = VegMatrixIndependent, BirdData, ColTraitVeg = "CanopyWidth") %>% arrange(Test)


```



```{r message=FALSE, error=FALSE, warning=FALSE}
png(paste0(here::here(), "/outputs/PlantBirdCongruence.png"),
    units = "in",
    res = 600, width = 6, height = 4)
plot(TreeHeightBird %>% filter(Test == "Mantel" & Group == "Overall")%>% mutate(Group = "Tree Height")%>%
bind_rows(BasalAreaBird %>% filter(Test == "Mantel" & Group == "Overall")%>% mutate(Group = "Basal Area")) %>%
 bind_rows(CanopyWidthBird %>% filter(Test == "Mantel" & Group == "Overall")%>% mutate(Group = "Canopy Width"))%>%
  mutate(Significance = case_when(`P-Value`<0.001 ~ "***",
                                  `P-Value`<0.05 ~ "**",
                                  `P-Value`<0.1 ~ "*"))%>%
  ggplot(aes(x = Group, y = Strength))+
  geom_bar(stat = "identity", position = "dodge")+
  geom_text(aes(label = Significance), size = 4)+
  theme_classic()+
  labs( y = "Strength of Cross-Taxon Congruence",
        x = "Proxy for Plant Community Structure",
        caption = "Birds & Plants"))
dev.off()
  
```


```{r include=FALSE}
BasalAreaAxis <- 
NMDS.ScreePoints(data = VegMatrixSiteID %>% arrange(SiteID)%>% 
                   ungroup() %>%select(contains("BasalArea")),
                 noRuns = 50)
CanopyWidthAxis <- 
NMDS.ScreePoints(data = VegMatrixSiteID %>% arrange(SiteID)%>% 
                   ungroup() %>%select(contains("CanopyWidth")),
                 noRuns = 50)
TreeHeightAxis <- 
NMDS.ScreePoints(data = VegMatrixSiteID %>% arrange(SiteID)%>% 
                   ungroup() %>%select(contains("TreeHeight")),
                 noRuns = 50)

```


```{r message=FALSE, error=FALSE, warning=FALSE}
BasalAreaAxis  %>% t() %>% data.frame()%>%
  mutate(Run = factor(1:50))%>% 
  pivot_longer(!Run,
               names_to = c("NoAxis"),
               names_pattern = "X(.*)",
               values_to = "Stress")%>%
  group_by(NoAxis) %>%
  summarise(Stress = mean(Stress))%>%
  ungroup()%>%
  mutate(NoAxis = factor(as.numeric(as.character(NoAxis))))%>%
  ggplot(aes(x = NoAxis, y = Stress))+
  geom_line(aes(group = 1), size = 1)+
  theme_classic()
CanopyWidthAxis  %>% t() %>% data.frame()%>%
  mutate(Run = factor(1:50))%>% 
  pivot_longer(!Run,
               names_to = c("NoAxis"),
               names_pattern = "X(.*)",
               values_to = "Stress")%>%
  group_by(NoAxis) %>%
  summarise(Stress = mean(Stress))%>%
  ungroup()%>%
  mutate(NoAxis = factor(as.numeric(as.character(NoAxis))))%>%
  ggplot(aes(x = NoAxis, y = Stress))+
  geom_line(aes(group = 1), size = 1)+
  theme_classic()
TreeHeightAxis  %>% t() %>% data.frame()%>%
  mutate(Run = factor(1:50))%>% 
  pivot_longer(!Run,
               names_to = c("NoAxis"),
               names_pattern = "X(.*)",
               values_to = "Stress")%>%
  group_by(NoAxis) %>%
  summarise(Stress = mean(Stress))%>%
  ungroup()%>%
  mutate(NoAxis = factor(as.numeric(as.character(NoAxis))))%>%
  ggplot(aes(x = NoAxis, y = Stress))+
  geom_line(aes(group = 1), size = 1)+
  theme_classic()
```


```{r include=FALSE}
TreeHeightSiteIDNMS <- metaMDS(VegMatrixSiteID %>% arrange(SiteID)%>% 
                   ungroup() %>%select(contains("TreeHeight")),
                                       distance = "bray",
                                 k = 2, autotransform = TRUE,trymax=100)
BasalAreaSiteIDNMS <- metaMDS(VegMatrixSiteID %>% arrange(SiteID)%>% 
                   ungroup() %>%select(contains("BasalArea")),
                                       distance = "bray",
                                 k = 2, autotransform = TRUE,trymax=100)
CanopyWidthSiteIDNMS <- metaMDS(VegMatrixSiteID %>% arrange(SiteID)%>% 
                   ungroup() %>%select(contains("CanopyWidth")),
                                       distance = "bray",
                                 k = 2, autotransform = TRUE,trymax=100)

TreeHeightIndependentNMS <- metaMDS(VegMatrixIndependent %>% arrange(Independent)%>% 
                   ungroup() %>%select(contains("TreeHeight")),
                                       distance = "bray",
                                 k = 2, autotransform = TRUE,trymax=100)
BasalAreaIndependentNMS <- metaMDS(VegMatrixIndependent %>% arrange(Independent)%>% 
                   ungroup() %>%select(contains("BasalArea")),
                                       distance = "bray",
                                 k = 2, autotransform = TRUE,trymax=100)
CanopyWidthIndependentNMS <- metaMDS(VegMatrixIndependent %>% arrange(Independent)%>% 
                   ungroup() %>%select(contains("CanopyWidth")),
                                       distance = "bray",
                                 k = 2, autotransform = TRUE,trymax=100)

```


```{r message=FALSE, error=FALSE, warning=FALSE}
BirdsPlantsNMDSPlots <-
  NMDSPlotsBirdsPlants(NMDSList = list(`Basal Area`= (BasalAreaIndependentNMS),
                                     `Canopy Width`= CanopyWidthIndependentNMS,
                                     `Tree Height`= TreeHeightIndependentNMS),
                     DataX = VegMatrixIndependent,
                     DataY = list(BirdDataSum, BirdDataSum),
                     Group = c("Species", "Food", "Behaviour",  "Nesting", "Habitat","Type"))
PlantsNMDSPlots <-
NMDSPlotsPlants(NMDSList = list(`Basal Area`= (BasalAreaSiteIDNMS),
                                     `Canopy Width`= CanopyWidthSiteIDNMS,
                                     `Tree Height`= TreeHeightSiteIDNMS),
                     DataX = VegMatrixSiteID)

```


# Tree Height
```{r message=FALSE, error=FALSE, warning=FALSE}


(dispersion <- betadisper(vegdist(decostand(VegMatrixSiteID %>% 
                            arrange(SiteID)%>% ungroup() %>%
                            select(contains(c("TreeHeight"))), "max", 2)), 
                          VegMatrixSiteID %>% arrange(SiteID)%>% ungroup() %>% 
                            select(SiteName) %>% reduce(c)))

#Average distance to median (birds):

#Conference      Levera Mt. Hartman  Westerhall 
#0.3646      0.5428      0.4265      0.3196 
```


```{r}
anova(dispersion)
TukeyHSD(dispersion)
```


```{r message=FALSE, error=FALSE, warning=FALSE}
adonis2(decostand(VegMatrixSiteID %>% 
                            arrange(SiteID)%>% ungroup() %>%
                            select(contains(c("TreeHeight"))), "max", 2) ~  VegMatrixSiteID %>% arrange(SiteID)%>% ungroup() %>% 
                            select(SiteName) %>% reduce(c),
                   method = "bray")

```


```{r}
png(paste0(here::here(), "/outputs/PlantTreeHeightSpecies.png"),
    units = "in",
    res = 600, width = 6, height = 4)
VegMatrixSiteID %>%
  ungroup()%>%
  select(contains(c("SiteName", "TreeHeight")))%>%
  pivot_longer(!SiteName)%>%
  mutate(Label = str_remove_all(name, "TreeHeight"))%>%
  ggplot(aes(x = SiteName, y = value, fill = Label))+
  geom_point(position = position_jitterdodge(), aes(color = Label), alpha = 0.3)+
  geom_boxplot(outlier.shape = NA)+
  theme_classic()+
  scale_colour_viridis(discrete = TRUE) +
  scale_fill_viridis(discrete = TRUE) +
  labs(color = " ", fill = " ", 
       x = "Site", y = "Tree Height (m)")+
  theme(legend.position = "bottom")

dev.off()

png(paste0(here::here(), "/outputs/PlantTreeHeightSite.png"),
    units = "in",
    res = 600, width = 6, height = 4)
VegMatrixSiteID %>%
  ungroup()%>%
  select(contains(c("SiteName", "TreeHeight")))%>%
  pivot_longer(!SiteName)%>%
  mutate(Label = str_remove_all(name, "TreeHeight"))%>%
  ggplot(aes(x = SiteName, y = value))+
  geom_point(alpha = 0.3)+
  geom_boxplot(outlier.shape = NA)+
  theme_classic()+
  scale_colour_viridis(discrete = TRUE) +
  scale_fill_viridis(discrete = TRUE) +
  labs(color = " ", fill = " ", 
       x = "Site", y = "Tree Height (m)")+
  theme(legend.position = "bottom")

dev.off()
```

# Canopy Width

```{r message=FALSE, error=FALSE, warning=FALSE}


(dispersion <- betadisper(vegdist(decostand(VegMatrixSiteID %>% 
                            arrange(SiteID)%>% ungroup() %>%
                            select(contains(c("CanopyWidth"))), "max", 2)), 
                          VegMatrixSiteID %>% arrange(SiteID)%>% ungroup() %>% 
                            select(SiteName) %>% reduce(c)))

#Average distance to median (birds):

#Conference      Levera Mt. Hartman  Westerhall 
#0.3646      0.5428      0.4265      0.3196 
```


```{r}
anova(dispersion)
TukeyHSD(dispersion)
```


```{r message=FALSE, error=FALSE, warning=FALSE}
adonis2(decostand(VegMatrixSiteID %>% 
                            arrange(SiteID)%>% ungroup() %>%
                            select(contains(c("CanopyWidth"))), "max", 2) ~  VegMatrixSiteID %>% arrange(SiteID)%>% ungroup() %>% 
                            select(SiteName) %>% reduce(c),
                   method = "bray")

```


```{r}
png(paste0(here::here(), "/outputs/PlantCanopyWidthSpecies.png"),
    units = "in",
    res = 600, width = 6, height = 4)
VegMatrixSiteID %>%
  ungroup()%>%
  select(contains(c("SiteName", "CanopyWidth")))%>%
  pivot_longer(!SiteName)%>%
  mutate(Label = str_remove_all(name, "CanopyWidth"))%>%
  ggplot(aes(x = SiteName, y = value, fill = Label))+
  geom_point(position = position_jitterdodge(), aes(color = Label), alpha = 0.3)+
  geom_boxplot(outlier.shape = NA)+
  theme_classic()+
  scale_colour_viridis(discrete = TRUE) +
  scale_fill_viridis(discrete = TRUE) +
  labs(color = " ", fill = " ", 
       x = "Site", y = "Canopy Width (m)")+
  theme(legend.position = "bottom")

dev.off()


png(paste0(here::here(), "/outputs/PlantCanopyWidthSite.png"),
    units = "in",
    res = 600, width = 6, height = 4)
VegMatrixSiteID %>%
  ungroup()%>%
  select(contains(c("SiteName", "CanopyWidth")))%>%
  pivot_longer(!SiteName)%>%
  mutate(Label = str_remove_all(name, "CanopyWidth"))%>%
  ggplot(aes(x = SiteName, y = value))+
  geom_point(alpha = 0.3)+
  geom_boxplot(outlier.shape = NA)+
  theme_classic()+
  scale_colour_viridis(discrete = TRUE) +
  scale_fill_viridis(discrete = TRUE) +
  labs(color = " ", fill = " ", 
       x = "Site", y = "Canopy Width (m)")+
  theme(legend.position = "bottom")

dev.off()
```

# Basal Area

```{r message=FALSE, error=FALSE, warning=FALSE}


(dispersion <- betadisper(vegdist(decostand(VegMatrixSiteID %>% 
                            arrange(SiteID)%>% ungroup() %>%
                            select(contains(c("BasalArea"))), "max", 2)), 
                          VegMatrixSiteID %>% arrange(SiteID)%>% ungroup() %>% 
                            select(SiteName) %>% reduce(c)))

#Average distance to median (birds):

#Conference      Levera Mt. Hartman  Westerhall 
#0.3646      0.5428      0.4265      0.3196 

#Average distance to median (plants):

#Conference      Levera Mt. Hartman  Westerhall 
# 0.4871      0.4453      0.3748      0.3162
```


```{r}
anova(dispersion)
TukeyHSD(dispersion)
```

```{r}
plot(dispersion)

```

```{r message=FALSE, error=FALSE, warning=FALSE}
adonis2(decostand(VegMatrixSiteID %>% 
                            arrange(SiteID)%>% ungroup() %>%
                            select(contains(c("BasalArea"))), "max", 2) ~  VegMatrixSiteID %>% arrange(SiteID)%>% ungroup() %>% 
                            select(SiteName) %>% reduce(c),
                   method = "bray")

```


```{r message=FALSE, error=FALSE, warning=FALSE}
adonis2(decostand(VegMatrixSiteID %>% 
                            arrange(SiteID)%>% ungroup() %>%
                            select(contains(c("BasalArea"))), "max", 2) ~  
          VegMatrixSiteID %>% arrange(SiteID)%>% ungroup() %>% 
                            select(SiteName) %>% reduce(c),
                   method = "bray")

```

```{r}
png(paste0(here::here(), "/outputs/PlantBasalAreaSpecies.png"),
    units = "in",
    res = 600, width = 6, height = 4)
VegMatrixSiteID %>%
  ungroup()%>%
  select(contains(c("SiteName", "BasalArea")))%>%
  pivot_longer(!SiteName)%>%
  mutate(Label = str_remove_all(name, "BasalArea"))%>%
  ggplot(aes(x = SiteName, y = value, fill = Label))+
  geom_point(position = position_jitterdodge(), aes(color = Label), alpha = 0.3)+
  geom_boxplot(outlier.shape = NA)+
  theme_classic()+
  scale_colour_viridis(discrete = TRUE) +
  scale_fill_viridis(discrete = TRUE) +
  labs(color = " ", fill = " ", 
       x = "Site", y = "Basal Area (m^2)")+
  theme(legend.position = "bottom")

dev.off()


png(paste0(here::here(), "/outputs/PlantBasalAreaSite.png"),
    units = "in",
    res = 600, width = 6, height = 4)
VegMatrixSiteID %>%
  ungroup()%>%
  select(contains(c("SiteName", "BasalArea")))%>%
  pivot_longer(!SiteName)%>%
  mutate(Label = str_remove_all(name, "BasalArea"))%>%
  ggplot(aes(x = SiteName, y = value))+
  geom_point(alpha = 0.3)+
  geom_boxplot(outlier.shape = NA)+
  theme_classic()+
  scale_colour_viridis(discrete = TRUE) +
  scale_fill_viridis(discrete = TRUE) +
  labs(color = " ", fill = " ", 
       x = "Site", y = "Basal Area (m^2)")+
  theme(legend.position = "bottom")

dev.off()
```





```{r message=FALSE, error=FALSE, warning=FALSE}
write_xlsx(x = list(`Plants - Independent (Mean)` = VegMatrixIndependent,
                    `Plants - SiteID (Mean)` = VegMatrixSiteID,
                    `Birds - Mean by Independent` = BirdData,
                    `Birds - Sum by Independent` = BirdDataSum,
                     `Birds - Sum by Date & Independent` = BirdDatDateSum),
           path = paste0(here::here(), "/data/DataFromCongruenceAnalyses.xlsx"))
```
